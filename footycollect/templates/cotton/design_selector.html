{% load i18n %}
{% load static %}

<!-- Cotton design selector component -->
<div class="mb-3">
  <label for="id_{{ name }}" class="form-label">{{ label }}</label>
  <select id="id_{{ name }}" name="{{ name }}" class="form-control d-none">
    <option value="">Select design</option>
    {% for design in design_choices %}
      <option value="{{ design.value }}"
              {% if design.value == data_selected %}selected{% endif %}>{{ design.label }}</option>
    {% endfor %}
  </select>
  <!-- SVG definitions for jersey shape mask -->
  <svg width="0" height="0" class="position-absolute">
    <defs>
    <clipPath id="jersey-shape">
    <!-- Simple t-shirt/jersey silhouette -->
    <path d="M25,0 H75 C80,0 82,5 85,15 L95,40 C95,45 95,50 90,50 L85,50 L85,100 H15 L15,50 L10,50 C5,50 5,45 5,40 L15,15 C18,5 20,0 25,0 Z" />
    </clipPath>
    </defs>
  </svg>
  <div class="design-selector-container">
    {% for design in design_choices %}
      <div class="design-option {% if design.value == data_selected %}selected{% endif %}"
           data-value="{{ design.value }}"
           title="{{ design.label }}"
           onclick="selectDesign('{{ name }}', '{{ design.value }}')">
        <div class="jersey-container">
          <div class="design-icon">
            {% if design.value == "PLAIN" %}
              <img src="{% static 'images/design_type/plain.svg' %}"
                   alt="Plain"
                   class="design-image" />
            {% elif design.value == "STRIPES" %}
              <img src="{% static 'images/design_type/stripes.svg' %}"
                   alt="Stripes"
                   class="design-image" />
            {% elif design.value == "GRAPHIC" %}
              <img src="{% static 'images/design_type/graphic.svg' %}"
                   alt="Graphic"
                   class="design-image" />
            {% elif design.value == "CHEST_BAND" %}
              <img src="{% static 'images/design_type/chest-band.svg' %}"
                   alt="Chest Band"
                   class="design-image" />
            {% elif design.value == "CONTRASTING_SLEEVES" %}
              <img src="{% static 'images/design_type/contrasting-sleeves.svg' %}"
                   alt="Contrasting Sleeves"
                   class="design-image" />
            {% elif design.value == "PINSTRIPES" %}
              <img src="{% static 'images/design_type/pinstripes.svg' %}"
                   alt="Pinstripes"
                   class="design-image" />
            {% elif design.value == "HOOPS" %}
              <img src="{% static 'images/design_type/hoops.svg' %}"
                   alt="Hoops"
                   class="design-image" />
            {% elif design.value == "SINGLE_STRIPE" %}
              <img src="{% static 'images/design_type/single-stripe.svg' %}"
                   alt="Single Stripe"
                   class="design-image" />
            {% elif design.value == "HALF_AND_HALF" %}
              <img src="{% static 'images/design_type/half-and-half.svg' %}"
                   alt="Half and Half"
                   class="design-image" />
            {% elif design.value == "SASH" %}
              <img src="{% static 'images/design_type/sash.svg' %}"
                   alt="Sash"
                   class="design-image" />
            {% elif design.value == "CHEVRON" %}
              <img src="{% static 'images/design_type/chevron.svg' %}"
                   alt="Chevron"
                   class="design-image" />
            {% elif design.value == "CHECKERS" %}
              <img src="{% static 'images/design_type/checkers.svg' %}"
                   alt="Checkers"
                   class="design-image" />
            {% elif design.value == "GRADIENT" %}
              <img src="{% static 'images/design_type/gradient.svg' %}"
                   alt="Gradient"
                   class="design-image" />
            {% elif design.value == "DIAGONAL" %}
              <img src="{% static 'images/design_type/diagonal.svg' %}"
                   alt="Diagonal"
                   class="design-image" />
            {% elif design.value == "CROSS" %}
              <img src="{% static 'images/design_type/cross.svg' %}"
                   alt="Cross"
                   class="design-image" />
            {% elif design.value == "QUARTERS" %}
              <img src="{% static 'images/design_type/quarters.svg' %}"
                   alt="Quarters"
                   class="design-image" />
            {% endif %}
          </div>
        </div>
        <span class="design-label">{{ design.label }}</span>
      </div>
    {% endfor %}
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    initializeDesignSelector();
  });

  function initializeDesignSelector() {
    const select = document.getElementById('id_{{ name }}');
    if (select && select.value) {
      const option = document.querySelector(`.design-option[data-value="${select.value}"]`);
      if (option) {
        option.classList.add('selected');
      }
    }
  }

  function selectDesign(fieldName, value) {
    const select = document.getElementById('id_' + fieldName);
    const container = select.closest('.mb-3');

    // Update select value
    select.value = value;

    // Update visual state
    const allOptions = container.querySelectorAll('.design-option');
    allOptions.forEach(option => option.classList.remove('selected'));

    const selectedOption = container.querySelector(`.design-option[data-value="${value}"]`);
    if (selectedOption) {
      selectedOption.classList.add('selected');
    }

    // Trigger change event
    select.dispatchEvent(new Event('change', {
      bubbles: true
    }));
  }
</script>
<style>
  .design-selector-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
    gap: 12px;
    margin-top: 12px;
  }

  .design-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .design-option:hover {
    transform: scale(1.05);
    border-color: #666;
  }

  .design-option.selected {
    border: 2px solid #0d6efd;
    background-color: #f8f9fa;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  .jersey-container {
    position: relative;
    width: 60px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
  }

  .design-icon {
    width: 100%;
    height: 100%;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
    position: relative;
  }

  .design-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }


  .design-label {
    font-size: 12px;
    text-align: center;
    color: #333;
  }
</style>
