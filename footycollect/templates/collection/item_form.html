{% extends "base.html" %}

{% load static %}

{% block content %}
  <!-- Test fuera del container -->
  {% comment %}Debug: Cotton test 1{% endcomment %}
  <c-test></c-test>
  <div class="container">
    <!-- Test dentro del container -->
    {% comment %}Debug: Cotton test 2{% endcomment %}
    <c-test></c-test>
    <form method="post" enctype="multipart/form-data" class="card">
      {% csrf_token %}
      <!-- Test dentro del form -->
      {% comment %}Debug: Cotton test 3{% endcomment %}
      <c-test></c-test>
      {{ wizard.management_form }}
      <div class="card-body">
        {% if wizard.form.forms %}
          {{ wizard.form.management_form }}
          {% for form in wizard.form.forms %}{{ form }}{% endfor %}
        {% else %}
          <h3 class="card-title">Item Details</h3>
          <!-- Test component -->
          <c-test></c-test>
          <!-- Debug visual -->
          <p>Debug: Antes del componente Cotton</p>
          <c-country-select name="details-country" data-url="{% url 'core:country-autocomplete' %}" data-selected="{{ wizard.form.country_code.value|default:'' }}"></c-country-select>
          <p>Debug: Después del componente Cotton</p>
          <!-- Campo hidden original -->
          <input type="hidden"
                 name="details-country_code"
                 id="id_details-country_code"
                 value="{{ wizard.form.country_code.value|default:'' }}" />
          <c-country-select url="{% url 'core:country-autocomplete' %}" data-selected="{{ wizard.form.country_code.value|default:'' }}"></c-country-select>
          <c-color-selector name="details-main_color" label="Main Color" data-selected="{{ wizard.form.main_color.value|default:'' }}" :color_choices="color_choices">
          </c-color-selector>
          <c-color-selector name="details-secondary_colors" label="Secondary Colors"  data-multiple="true" data-selected="{{ wizard.form.secondary_colors.value|default:'' }}" :color_choices="color_choices">
          </c-color-selector>
          <!-- Componente Cotton para el diseño -->
          <c-design-selector name="details-design" label="Design Pattern" data-selected="{{ wizard.form.design.value|default:'' }}" :design_choices="design_choices">
          </c-design-selector>
          {{ wizard.form.as_p }}
        {% endif %}
      </div>
      <div class="card-footer d-flex justify-content-between">
        {% if wizard.steps.prev %}
          <button name="wizard_goto_step"
                  type="submit"
                  value="{{ wizard.steps.prev }}"
                  class="btn btn-secondary">Previous</button>
        {% endif %}
        <button type="submit" class="btn btn-primary">
          {% if wizard.steps.next %}
            Next
          {% else %}
            Submit
          {% endif %}
        </button>
      </div>
    </form>
  </div>
  <!-- Test usando componente dinámico -->
  {% comment %}Debug: Cotton test dinámico{% endcomment %}
  <c-component is="test"></c-component>
{% endblock content %}
{% block js %}
  {{ block.super }}
  <!-- Asegurarnos que jQuery y Select2 están cargados -->
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
        rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
        rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/flag-icons@7.3.2/css/flag-icons.min.css"
        rel="stylesheet" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
    // Script para cargar colores desde FKAPI
    document.addEventListener('DOMContentLoaded', function() {
      const colorSelectors = document.querySelectorAll('[data-fkapi="true"]');
      if (colorSelectors.length > 0) {
        fetch('/api/colors/')
          .then(response => response.json())
          .then(data => {
            colorSelectors.forEach(selector => {
              // Actualizar opciones con datos de la API
              // Implementación depende de la estructura de datos de FKAPI
            });
          })
          .catch(error => console.error('Error loading colors from FKAPI:', error));
      }
    });
  </script>
{% endblock js %}
