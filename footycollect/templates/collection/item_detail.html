{% extends "base.html" %}

{% load i18n %}

{% block extra_css %}
  <style>
    #itemPhotos {
      min-height: 400px;
      position: relative;
    }

    #itemPhotos .carousel-inner {
      min-height: 400px;
      position: relative;
    }

    #itemPhotos .carousel-item {
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #itemPhotos img {
      display: block;
      width: 100%;
      max-width: 100%;
      height: auto;
      max-height: 600px;
      object-fit: contain;
      margin: 0 auto;
    }

    .carousel-thumbnails {
      max-width: 100%;
    }

    .carousel-thumbnail.btn {
      width: 80px !important;
      height: 80px !important;
      min-width: 80px !important;
      min-height: 80px !important;
      max-width: 80px !important;
      max-height: 80px !important;
      overflow: hidden !important;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s ease;
      opacity: 0.6;
      padding: 0 !important;
      margin: 0 !important;
      display: inline-flex !important;
      align-items: center;
      justify-content: center;
      background-color: #f8f9fa;
      flex-shrink: 0;
      box-sizing: border-box;
    }

    .carousel-thumbnail:hover {
      opacity: 0.8;
      transform: scale(1.05);
    }

    .carousel-thumbnail.active {
      opacity: 1;
      border-color: #0d6efd !important;
      border-width: 2px !important;
      transform: scale(1.1);
    }

    .carousel-thumbnail.btn .thumbnail-img,
    .carousel-thumbnail.btn img {
      width: 80px !important;
      height: 80px !important;
      min-width: 80px !important;
      min-height: 80px !important;
      max-width: 80px !important;
      max-height: 80px !important;
      object-fit: cover !important;
      display: block !important;
      flex-shrink: 0;
      margin: 0 !important;
      padding: 0 !important;
      box-sizing: border-box;
    }
  </style>
{% endblock extra_css %}
{% block content %}
  <div class="container py-4">
    <div class="card">
      <div class="card-body">
        <h2 class="card-title">{{ object }}</h2>
        <!-- Item details -->
        <div class="row mt-4">
          <div class="col-md-6">
            <!-- Photos -->
            {% if photos|length > 0 or object.photos.exists %}
              <div id="itemPhotos" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                  {% if photos|length > 0 %}
                    {% for photo in photos %}
                      <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        {% if photo.image_avif %}
                          <img src="{{ photo.image.url }}"
                               data-avif="{{ photo.image_avif.url }}"
                               class="d-block w-100"
                               alt=""
                               onerror="this.onerror=null; this.src=this.getAttribute('data-avif') || this.src;" />
                        {% else %}
                          <img src="{{ photo.image.url }}" class="d-block w-100" alt="" />
                        {% endif %}
                      </div>
                    {% endfor %}
                  {% else %}
                    {% for photo in object.photos.all %}
                      <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        {% if photo.image_avif %}
                          <img src="{{ photo.image.url }}"
                               data-avif="{{ photo.image_avif.url }}"
                               class="d-block w-100"
                               alt=""
                               onerror="this.onerror=null; this.src=this.getAttribute('data-avif') || this.src;" />
                        {% else %}
                          <img src="{{ photo.image.url }}" class="d-block w-100" alt="" />
                        {% endif %}
                      </div>
                    {% endfor %}
                  {% endif %}
                </div>
                {% if photos|length > 1 or object.photos.count > 1 %}
                  <button class="carousel-control-prev"
                          type="button"
                          data-bs-target="#itemPhotos"
                          data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                  </button>
                  <button class="carousel-control-next"
                          type="button"
                          data-bs-target="#itemPhotos"
                          data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                  </button>
                {% endif %}
              </div>
              {% if photos|length > 1 or object.photos.count > 1 %}
                <div class="carousel-thumbnails mt-3 d-flex justify-content-center gap-2 flex-wrap">
                  {% if photos|length > 0 %}
                    {% for photo in photos %}
                      <button type="button"
                              class="carousel-thumbnail btn p-0 border {% if forloop.first %}active{% endif %}"
                              data-bs-target="#itemPhotos"
                              data-bs-slide-to="{{ forloop.counter0 }}"
                              aria-label="Slide {{ forloop.counter }}">
                        {% if photo.image_avif %}
                          <img src="{{ photo.image.url }}"
                               data-avif="{{ photo.image_avif.url }}"
                               class="thumbnail-img"
                               alt=""
                               onerror="this.onerror=null; this.src=this.getAttribute('data-avif') || this.src;" />
                        {% else %}
                          <img src="{{ photo.image.url }}" class="thumbnail-img" alt="" />
                        {% endif %}
                      </button>
                    {% endfor %}
                  {% else %}
                    {% for photo in object.photos.all %}
                      <button type="button"
                              class="carousel-thumbnail btn p-0 border {% if forloop.first %}active{% endif %}"
                              data-bs-target="#itemPhotos"
                              data-bs-slide-to="{{ forloop.counter0 }}"
                              aria-label="Slide {{ forloop.counter }}">
                        {% if photo.image_avif %}
                          <img src="{{ photo.image.url }}"
                               data-avif="{{ photo.image_avif.url }}"
                               class="thumbnail-img"
                               alt=""
                               onerror="this.onerror=null; this.src=this.getAttribute('data-avif') || this.src;" />
                        {% else %}
                          <img src="{{ photo.image.url }}" class="thumbnail-img" alt="" />
                        {% endif %}
                      </button>
                    {% endfor %}
                  {% endif %}
                </div>
              {% endif %}
            {% endif %}
          </div>
          <div class="col-md-6">
            <!-- Item information -->
            <dl class="row">
              <!-- Base Item fields -->
              <dt class="col-sm-4">{% trans "Name" %}</dt>
              <dd class="col-sm-8">
                {{ object.name }}
              </dd>
              <dt class="col-sm-4">{% trans "Brand" %}</dt>
              <dd class="col-sm-8">
                {% if object.brand.logo and object.brand.logo != "https://www.footballkitarchive.com/static/logos/not_found.png" %}
                  <img src="{{ object.brand.logo }}"
                       alt="{{ object.brand.name }}"
                       class="img-fluid me-2"
                       width="20"
                       height="20" />
                {% endif %}
                {{ object.brand.name }}
              </dd>
              <dt class="col-sm-4">{% trans "Condition" %}</dt>
              <dd class="col-sm-8">
                {{ object.get_condition_display }}
              </dd>
              <dt class="col-sm-4">{% trans "Added on" %}</dt>
              <dd class="col-sm-8">
                {{ object.created_at|date:"d M Y" }}
              </dd>
              <dt class="col-sm-4">{% trans "Last updated" %}</dt>
              <dd class="col-sm-8">
                {{ object.updated_at|date:"d M Y" }}
              </dd>
              <!-- Jersey specific fields -->
              {% if object.club %}
                <dt class="col-sm-4">{% trans "Team" %}</dt>
                <dd class="col-sm-8">
                  {% if object.club.logo and object.club.logo != "https://www.footballkitarchive.com/static/logos/not_found.png" %}
                    <img src="{{ object.club.logo }}"
                         alt="{{ object.club.name }}"
                         class="img-fluid me-2"
                         width="20"
                         height="20" />
                  {% endif %}
                  {{ object.club.name }}
                  {% if object.club.country %}
                    <br />
                    <small class="text-muted">
                      <span class="fi fi-{{ object.club.country.code|lower }}"></span>
                      {{ object.club.country.name }}
                    </small>
                  {% endif %}
                </dd>
              {% endif %}
              {% if object.country %}
                <dt class="col-sm-4">{% trans "Country" %}</dt>
                <dd class="col-sm-8">
                  <span class="fi fi-{{ object.country.code|lower }}"></span>
                  {{ object.country.name }}
                </dd>
              {% endif %}
              {% if object.season %}
                <dt class="col-sm-4">{% trans "Season" %}</dt>
                <dd class="col-sm-8">
                  {{ object.season }}
                </dd>
              {% endif %}
              {% if object.size %}
                <dt class="col-sm-4">{% trans "Size" %}</dt>
                <dd class="col-sm-8">
                  {{ object.size }}
                </dd>
              {% endif %}
              {% if object.main_color %}
                <dt class="col-sm-4">{% trans "Main Color" %}</dt>
                <dd class="col-sm-8">
                  {{ object.get_main_color_display }}
                </dd>
              {% endif %}
              {% if object.design %}
                <dt class="col-sm-4">{% trans "Design" %}</dt>
                <dd class="col-sm-8">
                  {{ object.get_design_display }}
                </dd>
              {% endif %}
              {% if object.competitions.exists %}
                <dt class="col-sm-4">{% trans "Competitions" %}</dt>
                <dd class="col-sm-8">
                  {% for competition in object.competitions.all %}
                    {% if competition.logo and competition.logo != "https://www.footballkitarchive.com/static/logos/not_found.png" %}
                      <img src="{{ competition.logo }}"
                           alt="{{ competition.name }}"
                           class="img-fluid me-2"
                           width="20"
                           height="20" />
                    {% endif %}
                    {{ competition.name }}
                    {% if not forloop.last %},{% endif %}
                  {% endfor %}
                </dd>
              {% endif %}
              {% if object.player_name %}
                <dt class="col-sm-4">{% trans "Player Name" %}</dt>
                <dd class="col-sm-8">
                  {{ object.player_name }}
                </dd>
              {% endif %}
              {% if object.number %}
                <dt class="col-sm-4">{% trans "Number" %}</dt>
                <dd class="col-sm-8">
                  {{ object.number }}
                </dd>
              {% endif %}
              {% if object.match_worn %}
                <dt class="col-sm-4">{% trans "Match Worn" %}</dt>
                <dd class="col-sm-8">
                  {% if object.match_worn %}
                    Yes
                  {% else %}
                    No
                  {% endif %}
                </dd>
              {% endif %}
              {% if object.signed %}
                <dt class="col-sm-4">{% trans "Signed" %}</dt>
                <dd class="col-sm-8">
                  {% if object.signed %}
                    Yes
                  {% else %}
                    No
                  {% endif %}
                </dd>
              {% endif %}
            </dl>
            {% if object.description %}
              <h5>{% trans "Description" %}</h5>
              <p>{{ object.description }}</p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock content %}
{% block inline_javascript %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const carousel = document.getElementById('itemPhotos');
      if (carousel) {
        const thumbnails = document.querySelectorAll('.carousel-thumbnail');
        const thumbnailImgs = document.querySelectorAll('.carousel-thumbnail img');

        thumbnails.forEach(function(thumb) {
          thumb.style.width = '80px';
          thumb.style.height = '80px';
          thumb.style.minWidth = '80px';
          thumb.style.minHeight = '80px';
          thumb.style.maxWidth = '80px';
          thumb.style.maxHeight = '80px';
          thumb.style.overflow = 'hidden';
          thumb.style.display = 'inline-flex';
          thumb.style.alignItems = 'center';
          thumb.style.justifyContent = 'center';
        });

        thumbnailImgs.forEach(function(img) {
          img.style.width = '80px';
          img.style.height = '80px';
          img.style.minWidth = '80px';
          img.style.minHeight = '80px';
          img.style.maxWidth = '80px';
          img.style.maxHeight = '80px';
          img.style.objectFit = 'cover';
          img.style.display = 'block';
        });

        carousel.addEventListener('slid.bs.carousel', function(event) {
          thumbnails.forEach(function(thumb, index) {
            if (index === event.to) {
              thumb.classList.add('active');
            } else {
              thumb.classList.remove('active');
            }
          });
        });
      }
    });
  </script>
{% endblock inline_javascript %}
