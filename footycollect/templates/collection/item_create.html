{% extends "base.html" %}

{% load i18n static %}
{% load crispy_forms_tags %}

{% block extra_css %}
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css"
        rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css"
        rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/flag-icons@7.3.2/css/flag-icons.min.css"
        rel="stylesheet" />
  <style>
    .fi {
      margin-right: 8px;
      border-radius: 3px;
      width: 1.3em;
      height: 1em;
      box-shadow: 0 0 1px rgba(0, 0, 0, 0.2);
      vertical-align: middle;
    }

    .select2-results__option {
      line-height: 1.8em;
    }

    .select2-selection__rendered .fi {
      margin-right: 5px;
      vertical-align: -0.1em;
    }
  </style>
{% endblock extra_css %}
{% block content %}
  {{ form.media }}
  <div class="container py-4">
    <h1>{% trans "Add New Item" %}</h1>
    {% if messages %}
      <div class="messages">
        {% for message in messages %}<div class="alert alert-{{ message.tags }}">{{ message }}</div>{% endfor %}
      </div>
    {% endif %}
    <form method="post" enctype="multipart/form-data" id="item-form">
      {% csrf_token %}
      <!-- Item Details -->
      <div class="card mb-4">
        <div class="card-body">{{ form|crispy }}</div>
      </div>
      <!-- Photo Manager -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">{% trans "Photos" %}</h5>
        </div>
        <div class="card-body">
          <c-collection.photo_manager></c-collection.photo_manager>
        </div>
      </div>
      <div class="d-grid gap-2 d-md-flex justify-content-md-end">
        <button type="submit" class="btn btn-primary">{% trans "Create Item" %}</button>
      </div>
    </form>
  </div>
{% endblock content %}
{% block extra_js %}
  {{ form.media.js }}
  <script>
    $(document).ready(function() {
      const $countryField = $('#id_country_code');

      $countryField.select2({
        ajax: {
          url: "{% url 'core:country-autocomplete' %}",
          dataType: 'json',
          delay: 250,
          processResults: function(data) {
            return {
              results: data.results
            };
          }
        },
        templateResult: function(result) {
          return result.html || result.text;
        },
        templateSelection: function(selection) {
          return selection.html || selection.text;
        }
      });
    });
  </script>
{% endblock extra_js %}
